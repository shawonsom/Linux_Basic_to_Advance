# Load Balancing Methods in Linux CentOS

A comprehensive guide to implementing various load balancing methods on CentOS systems.

## üìä Load Balancing Methods

### 1. **Round Robin**
**Method**: Distributes requests sequentially across all servers
**Use Case**: General purpose, equal capacity servers

```bash
# Example: Nginx Round Robin Configuration
upstream backend {
    server 192.168.1.10:80;
    server 192.168.1.11:80;
    server 192.168.1.12:80;
}

server {
    location / {
        proxy_pass http://backend;
    }
}
```

### 2. **Least Connections**
**Method**: Directs traffic to the server with the fewest active connections
**Use Case**: When servers have varying connection handling capabilities

```bash
# Nginx Least Connections
upstream backend {
    least_conn;
    server 192.168.1.10:80;
    server 192.168.1.11:80;
}

# HAProxy configuration
backend web_servers
    balance leastconn
    server web1 192.168.1.10:80 check
    server web2 192.168.1.11:80 check
```

### 3. **IP Hash**
**Method**: Uses client IP address to determine which server receives the request
**Use Case**: Session persistence requirements

```bash
# Nginx IP Hash
upstream backend {
    ip_hash;
    server 192.168.1.10:80;
    server 192.168.1.11:80;
}

# HAProxy source-based balancing
backend web_servers
    balance source
    server web1 192.168.1.10:80 check
    server web2 192.168.1.11:80 check
```

### 4. **Weighted Round Robin**
**Method**: Distributes requests based on server capacity weights
**Use Case**: Heterogeneous server environments

```bash
# Nginx Weighted Round Robin
upstream backend {
    server 192.168.1.10:80 weight=3;  # 3x more traffic
    server 192.168.1.11:80 weight=2;  # 2x more traffic  
    server 192.168.1.12:80 weight=1;  # Base weight
}

# HAProxy weighted
backend web_servers
    balance roundrobin
    server web1 192.168.1.10:80 weight 3 check
    server web2 192.168.1.11:80 weight 2 check
```

### 5. **Least Response Time**
**Method**: Selects server with lowest average response time
**Use Case**: Performance-critical applications

```bash
# Nginx Least Time (Commercial version)
upstream backend {
    least_time header;
    server 192.168.1.10:80;
    server 192.168.1.11:80;
}
```

### 6. **URL Hash**
**Method**: Distributes based on requested URL
**Use Case**: Cache optimization

```bash
# Nginx URL Hash
upstream backend {
    hash $request_uri;
    server 192.168.1.10:80;
    server 192.168.1.11:80;
}
```

## üõ†Ô∏è Practical Implementation on CentOS

### Installation & Setup

```bash
# Install Nginx on CentOS 7/8
sudo yum install epel-release -y
sudo yum install nginx -y

# Install HAProxy
sudo yum install haproxy -y

# Start and enable services
sudo systemctl start nginx
sudo systemctl enable nginx
sudo systemctl start haproxy
sudo systemctl enable haproxy
```

### Complete Nginx Load Balancer Setup

```bash
# /etc/nginx/nginx.conf
http {
    upstream backend_pool {
        # Weighted Round Robin
        server 192.168.1.10:80 weight=3 max_fails=2 fail_timeout=30s;
        server 192.168.1.11:80 weight=2 max_fails=2 fail_timeout=30s;
        server 192.168.1.12:80 weight=1 max_fails=2 fail_timeout=30s;
        
        # Health check (Nginx Plus)
        # health_check;
    }

    server {
        listen 80;
        server_name loadbalancer.example.com;

        location / {
            proxy_pass http://backend_pool;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            
            # Timeout settings
            proxy_connect_timeout 30s;
            proxy_send_timeout 30s;
            proxy_read_timeout 30s;
        }

        # Status page (Nginx Plus)
        location /nginx_status {
            stub_status;
            allow 127.0.0.1;
            deny all;
        }
    }
}
```

### Complete HAProxy Setup

```bash
# /etc/haproxy/haproxy.cfg
global
    daemon
    maxconn 4096

defaults
    mode http
    timeout connect 5000ms
    timeout client 50000ms
    timeout server 50000ms
    option forwardfor
    option httpchk GET /health

frontend http_front
    bind *:80
    stats uri /haproxy?stats
    default_backend http_back

backend http_back
    balance leastconn
    server web1 192.168.1.10:80 check inter 2000 rise 2 fall 3
    server web2 192.168.1.11:80 check inter 2000 rise 2 fall 3
    server web3 192.168.1.12:80 check inter 2000 rise 2 fall 3

# For TCP load balancing (database, etc)
listen mysql_cluster
    bind *:3306
    mode tcp
    balance roundrobin
    server db1 192.168.1.20:3306 check
    server db2 192.168.1.21:3306 check backup
```

## üîß Advanced Load Balancing Features

### Health Checks

```bash
# Nginx active health checks (Plus version)
upstream backend {
    zone backend 64k;
    server 192.168.1.10:80;
    server 192.168.1.11:80;
    
    health_check interval=5s fails=3 passes=2 uri=/health;
}

# HAProxy health checks
backend web_servers
    option httpchk GET /health
    http-check expect status 200
    server web1 192.168.1.10:80 check inter 10s fall 3 rise 2
```

### Session Persistence

```bash
# Nginx sticky sessions
upstream backend {
    sticky cookie srv_id expires=1h domain=.example.com path=/;
    server 192.168.1.10:80;
    server 192.168.1.11:80;
}

# HAProxy session persistence
backend web_servers
    balance roundrobin
    cookie SERVERID insert indirect nocache
    server web1 192.168.1.10:80 cookie web1 check
    server web2 192.168.1.11:80 cookie web2 check
```

## üìà Monitoring & Statistics

### Nginx Status Module

```bash
# Enable status module in nginx.conf
server {
    listen 8080;
    server_name localhost;
    
    location /nginx-status {
        stub_status on;
        access_log off;
        allow 127.0.0.1;
        deny all;
    }
}

# Check status
curl http://127.0.0.1:8080/nginx-status
```

### HAProxy Statistics

```bash
# Add to haproxy.cfg
listen stats
    bind *:1936
    mode http
    stats enable
    stats hide-version
    stats realm Haproxy\ Statistics
    stats uri /
    stats auth admin:password
```

## üöÄ Performance Tuning

```bash
# Kernel tuning for load balancer
echo 'net.ipv4.ip_local_port_range = 1024 65535' >> /etc/sysctl.conf
echo 'net.core.somaxconn = 65536' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_tw_reuse = 1' >> /etc/sysctl.conf
sysctl -p

# Increase file descriptors
echo '* soft nofile 65536' >> /etc/security/limits.conf
echo '* hard nofile 65536' >> /etc/security/limits.conf
```

## üîç Troubleshooting Commands

```bash
# Check load balancer status
systemctl status nginx
systemctl status haproxy

# Test connectivity
curl -I http://loadbalancer-ip/
telnet backend-server-ip 80

# Monitor logs
tail -f /var/log/nginx/access.log
tail -f /var/log/haproxy.log

# Check server health
haproxy -c -f /etc/haproxy/haproxy.cfg
nginx -t
```

## üìö Use Case Scenarios

| Method | Best For | CentOS Solution |
|--------|----------|-----------------|
| **Round Robin** | Equal capacity servers | Nginx upstream |
| **Least Connections** | Varying server loads | HAProxy leastconn |
| **IP Hash** | Session persistence | Nginx ip_hash |
| **Weighted** | Different server specs | Nginx weight parameter |
| **Geographic** | Global applications | DNS-based + Nginx |

---

**Maintenance Tip**: Always test load balancing configurations in a staging environment before deploying to production. Monitor server metrics and adjust weights/parameters based on actual performance data.

*Last updated: $(date)*
```

This README provides:
- Clear explanations of each load balancing method
- Practical CentOS-specific configuration examples
- Complete setup guides for both Nginx and HAProxy
- Advanced features and troubleshooting
- Performance tuning recommendations
- Real-world use case scenarios

The examples are ready to use and include best practices for production environments.
